name: Back-end Continuous Integration

on:
  pull_request:
    branches:
    - master
  push:
    branches:
    - master


jobs:
  integration:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.8.6'

      - name: Adding project to PYTHONPATH
        run: |
          PYTHONPATH=${PYTHONPATH}:${PWD}

      - name: Upgrading pip
        run: python -m pip install --upgrade pip

      - name: Install dependencies
        run: pip install -r requirements.txt --target ./packages

      - name: Zipping dependencies
        run: | 
          echo "$(pwd)"
          cd ./packages
          echo "SITE PACKAGES"
          ls
          chmod -R 777 .
          zip -r9 ../function.zip .

      - name: Adding API App to Zipfile
        run: |
          echo "$(pwd)"
          chmod -R 777 app
          zip -g ./function.zip -r app
      
      - uses: actions/upload-artifact@v2
        with:
          name: testZippedLambda
          path: ./function.zip